# Activo el módulo de taller
![Captura 1](.\a1.png)
# Creo los modelos
# cliente.py
```python
# -*- coding: utf-8 -*-
from odoo import models, fields

class TallerCliente(models.Model):
    _name = 'taller.cliente'
    _description = 'Cliente'

    name = fields.Char(string="Nombre", required=True)
    telefono = fields.Char(string="Teléfono")
    email = fields.Char(string="Email")
    direccion = fields.Char(string="Dirección")
    
    vehiculo_ids = fields.One2many('taller.vehiculo', 'cliente_id', string="Vehículos")
```
# pieza.py
```python
# -*- coding: utf-8 -*-
from odoo import models, fields, api
from odoo.exceptions import ValidationError

class TallerPieza(models.Model):
    _name = 'taller.pieza'
    _description = 'Pieza'

    name = fields.Char(string="Nombre", required=True)
    codigo = fields.Char(string="Código")
    precio_unitario = fields.Float(string="Precio Unitario", required=True)
    reparacion_ids = fields.Many2many('taller.reparacion', string="Reparaciones")

    @api.constrains('precio_unitario')
    def _check_precio(self):
        for record in self:
            if record.precio_unitario <= 0:
                raise ValidationError("El precio unitario debe ser superior a 0.")
```
# reparacion.py
```python
# -*- coding: utf-8 -*-
from odoo import models, fields, api

class TallerReparacion(models.Model):
    _name = 'taller.reparacion'
    _description = 'Reparación'

    fecha_inicio = fields.Date(string="Fecha Inicio", default=fields.Date.today)
    fecha_fin = fields.Date(string="Fecha Fin")
    descripcion = fields.Text(string="Descripción")
    
    estado = fields.Selection([
        ('borrador', 'Borrador'),
        ('en_curso', 'En Curso'),
        ('finalizada', 'Finalizada')
    ], string="Estado", default='borrador', required=True)

    vehiculo_id = fields.Many2one('taller.vehiculo', string="Vehículo", required=True)
    tecnico_id = fields.Many2one('res.users', string="Técnico")
    pieza_ids = fields.Many2many('taller.pieza', string="Piezas")
    
    coste_total = fields.Float(string="Coste Total", compute='_compute_coste_total', store=True)

    @api.depends('pieza_ids', 'pieza_ids.precio_unitario')
    def _compute_coste_total(self):
        for record in self:
            record.coste_total = sum(pieza.precio_unitario for pieza in record.pieza_ids)

    def action_abrir(self):
        self.estado = 'en_curso'

    def action_cerrar(self):
        self.estado = 'finalizada'
        self.fecha_fin = fields.Date.today()

    def action_reabrir(self):
        self.estado = 'en_curso'
        self.fecha_fin = False
```
# vehiculo.py
```python
# -*- coding: utf-8 -*-
from odoo import models, fields

class TallerVehiculo(models.Model):
    _name = 'taller.vehiculo'
    _description = 'Vehículo'

    matricula = fields.Char(string="Matrícula", required=True)
    marca = fields.Char(string="Marca", required=True)
    modelo = fields.Char(string="Modelo", required=True)
    anio = fields.Integer(string="Año")
    
    cliente_id = fields.Many2one('taller.cliente', string="Cliente", required=True)
    reparacion_ids = fields.One2many('taller.reparacion', 'vehiculo_id', string="Reparaciones")
```
# Creo las vistas
# cliente_views.xml
```xml
<odoo>
    <record id="view_taller_cliente_tree" model="ir.ui.view">
        <field name="name">taller.cliente.tree</field>
        <field name="model">taller.cliente</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="telefono"/>
                <field name="email"/>
            </tree>
        </field>
    </record>

    <record id="view_taller_cliente_form" model="ir.ui.view">
        <field name="name">taller.cliente.form</field>
        <field name="model">taller.cliente</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="telefono"/>
                        <field name="email"/>
                        <field name="direccion"/>
                    </group>
                    <notebook>
                        <page string="Vehículos">
                            <field name="vehiculo_ids"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_taller_cliente" model="ir.actions.act_window">
        <field name="name">Clientes</field>
        <field name="res_model">taller.cliente</field>
        <field name="view_mode">tree,form</field>
    </record>
</odoo>
```
# pieza_views.xml
```xml
<odoo>
    <record id="view_taller_pieza_tree" model="ir.ui.view">
        <field name="name">taller.pieza.tree</field>
        <field name="model">taller.pieza</field>
        <field name="arch" type="xml">
            <tree decoration-success="precio_unitario &lt; 10" 
                  decoration-danger="precio_unitario &gt; 100">
                <field name="name"/>
                <field name="codigo"/>
                <field name="precio_unitario"/>
            </tree>
        </field>
    </record>

    <record id="view_taller_pieza_form" model="ir.ui.view">
        <field name="name">taller.pieza.form</field>
        <field name="model">taller.pieza</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="codigo"/>
                        <field name="precio_unitario"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_taller_pieza" model="ir.actions.act_window">
        <field name="name">Piezas</field>
        <field name="res_model">taller.pieza</field>
        <field name="view_mode">tree,form</field>
    </record>
</odoo>
```
# reparacion_views.xml
```xml
<odoo>
    <record id="view_taller_reparacion_tree" model="ir.ui.view">
        <field name="name">taller.reparacion.tree</field>
        <field name="model">taller.reparacion</field>
        <field name="arch" type="xml">
            <tree decoration-muted="estado == 'borrador'" 
                  decoration-info="estado == 'en_curso'" 
                  decoration-success="estado == 'finalizada'">
                
                <field name="vehiculo_id"/>
                <field name="fecha_inicio"/>
                <field name="estado"/>
                
                <field name="coste_total" 
                       decoration-danger="coste_total &gt; 500"
                       decoration-warning="coste_total &gt;= 100 and coste_total &lt;= 500"
                       decoration-success="coste_total &lt; 100"/>
            </tree>
        </field>
    </record>

    <record id="view_taller_reparacion_form" model="ir.ui.view">
        <field name="name">taller.reparacion.form</field>
        <field name="model">taller.reparacion</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_abrir" string="Abrir reparación" type="object" class="oe_highlight" 
                            attrs="{'invisible': [('estado', '!=', 'borrador')]}"/>
                            
                    <button name="action_cerrar" string="Cerrar reparación" type="object" class="oe_highlight" 
                            attrs="{'invisible': [('estado', '!=', 'en_curso')]}"/>
                            
                    <button name="action_reabrir" string="Reabrir" type="object" 
                            attrs="{'invisible': [('estado', '!=', 'finalizada')]}"/>
                            
                    <field name="estado" widget="statusbar"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="vehiculo_id" attrs="{'readonly': [('estado', '=', 'finalizada')]}"/>
                            <field name="tecnico_id" attrs="{'readonly': [('estado', '=', 'finalizada')]}"/>
                        </group>
                        <group>
                            <field name="fecha_inicio" attrs="{'readonly': [('estado', '=', 'finalizada')]}"/>
                            <field name="fecha_fin" attrs="{'readonly': [('estado', '=', 'finalizada')]}"/>
                            <field name="coste_total"/>
                        </group>
                    </group>
                    <group>
                        <field name="descripcion" attrs="{'readonly': [('estado', '=', 'finalizada')]}"/>
                    </group>
                    <notebook>
                        <page string="Piezas">
                            <field name="pieza_ids" attrs="{'readonly': [('estado', '=', 'finalizada')]}"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_taller_reparacion" model="ir.actions.act_window">
        <field name="name">Reparaciones</field>
        <field name="res_model">taller.reparacion</field>
        <field name="view_mode">tree,form</field>
    </record>
</odoo>
```
# vehiculos_views.xml
```xml
<odoo>
    <record id="view_taller_vehiculo_tree" model="ir.ui.view">
        <field name="name">taller.vehiculo.tree</field>
        <field name="model">taller.vehiculo</field>
        <field name="arch" type="xml">
            <tree>
                <field name="matricula"/>
                <field name="marca"/>
                <field name="modelo"/>
                <field name="cliente_id"/>
            </tree>
        </field>
    </record>

    <record id="view_taller_vehiculo_form" model="ir.ui.view">
        <field name="name">taller.vehiculo.form</field>
        <field name="model">taller.vehiculo</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="matricula"/>
                        <field name="marca"/>
                        <field name="modelo"/>
                        <field name="anio"/>
                        <field name="cliente_id"/>
                    </group>
                    <notebook>
                        <page string="Reparaciones">
                            <field name="reparacion_ids"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_taller_vehiculo" model="ir.actions.act_window">
        <field name="name">Vehículos</field>
        <field name="res_model">taller.vehiculo</field>
        <field name="view_mode">tree,form</field>
    </record>
</odoo>
```
# menus.xml
```xml
<odoo>
    <menuitem id="menu_taller_root" name="Taller" web_icon="taller,static/description/icon.png"/>

    <menuitem id="menu_taller_operaciones" parent="menu_taller_root" name="Operaciones" sequence="10"/>
    
    <menuitem id="menu_taller_reparacion" parent="menu_taller_operaciones" action="action_taller_reparacion" sequence="1"/>
    <menuitem id="menu_taller_vehiculo" parent="menu_taller_operaciones" action="action_taller_vehiculo" sequence="2"/>
    <menuitem id="menu_taller_cliente" parent="menu_taller_operaciones" action="action_taller_cliente" sequence="3"/>

    <menuitem id="menu_taller_config" parent="menu_taller_root" name="Configuración" sequence="20"/>
    
    <menuitem id="menu_taller_pieza" parent="menu_taller_config" action="action_taller_pieza" sequence="1"/>
</odoo>
```
# el __manifest__.py
```python
# -*- coding: utf-8 -*-
{
    'name': "taller",

    'summary': """
        Short (1 phrase/line) summary of the module's purpose, used as
        subtitle on modules listing or apps.openerp.com""",

    'description': """
        Long description of module's purpose
    """,

    'author': "David Ramos",
    'website': "https://www.yourcompany.com",

    # Categories can be used to filter modules in modules listing
    # Check https://github.com/odoo/odoo/blob/16.0/odoo/addons/base/data/ir_module_category_data.xml
    # for the full list
    'category': 'Uncategorized',
    'version': '0.1',

    # any module necessary for this one to work correctly
    'depends': ['base'],

    # always loaded
    'data': [
        'security/ir.model.access.csv',
        'views/cliente_views.xml',
        'views/vehiculo_views.xml',
        'views/pieza_views.xml',
        'views/reparacion_views.xml',
        'views/menus.xml',
    ],
    # only loaded in demonstration mode
    'demo': [
        'demo/demo.xml',
    ],
}

```
# Compruebo que funciona
![Captura 2](.\a2.png)
![Captura 3](.\a3.png)
![Captura 4](.\a4.png)
![Captura 5](.\a5.png)